#运输层

##概述和运输层服务
- 运输层协议为运行在不同主机上的应用程序之间提供了逻辑通信功能。
- 运输层协议是在端系统中而不是在网络路由器中实现。在发送方，运输层将接收到的来自发送应用进程的报文转换成运输层分组，用因特网术语称其为运输层报文段。可能的方法是，将应用层报文划分成较小的块，
并为每块加上一个运输层首部来创建运输层报文段。然后，在发送方端系统中，运输层将这些报文段传输给网络层，网络层将其封装成网络层分组（一个数据报）并向目的地发送。注意:网络路由器进作用于该数据报的网络层字段，
即他们不会检查封装在该数据报的运输层报文段的字段。在接收方，网络层在数据报中提取运输层报文段，并将该报文段向上交给运输层。运输层则处理接收到的报文段，使得接收方应用进程可应用该报文段中的数据。
###运输层和网络层的关系
- 运输层为运行在不同主机上的进程之间提供了逻辑通信，而网络层则提供了主机之间的逻辑通信
###因特网运输层概述P126
- UDP和TCP的基本任务是，将两个端系统间IP的交付服务扩展为运行在两个端系统上的进程间的交付服务。将主机间交付扩展到进程间交付，称为运输层的多路复用与多路分解。
- UDP和TCP可以通过在其报文段的首部中添加差错检测字段而提供完整性检查。
- TCP提供可靠数据传输、拥塞控制。
##多路复用与多路分解
- 在目的主机，运输层从紧邻其下的网络层接收报文段。运输层负责将这些报文段中的数据交付给在主机上运行的合适的应用程序。
- 进程（作为网络的一部分）有一个或多个套接字（socket），它相当于从网络向进程传递数据和从进程向网络传递数据的门户。接收主机中的运输层实际上并没有将数据直接交付给进程，而是通过
一个中间的套接字来传递。由于任何时候接收主机上可能有多个套接字，所以每个套接字都有唯一的标识符，标识符格式取决于他是UDP还是TCP。
- 接收主机如何将一个收到的运输层报文段定向到合适的套接字？：为达到这一目的，在每个运输层报文段中设置几个字段。在接收端，运输层检查这些字段并标识出接收套接字，然后将报文段定向到该套接字。
- 将运输层报文段中的数据交付到正确的套接字的工作成为多路分解；
- 从源主机的不同套接字中收集数据块，并为每个数据块封装上首部信息（这将在多路分解上用）从而生成报文段，然后将报文段传递到网络层的工作称为多路复用。 P128 2018年5月22日 12:39:50
- 多路复用的要求：套接字有唯一标识；每个报文段有特殊字段来指示该报文段所要交付的套接字。这些特殊字段是源端口号和目的端口号
- 无连接的多路复用和多路分解：一个UDP套接字是由一个包含目的IP地址和目的端口号的二元组来全面标识的，如果两个UDP报文段有着不同的源IP地址或源端口号，但有着相同的目的IP地址和目的端口号，那么这两个报文段将通过相同的目的套接字定向到相同的目的进程。
- 面向连接的多路复用和多路分解：TCP套接字是由一个四元组（源IP地址、源端口号、目的IP地址、目的端口号）来标识，两个具有不同源IP地址或源端口号的到达的TCP报文段将被定向到两个不同的套接字，除非TCP携带了初始创建连接的请求。
- TCP连接的四元组能够定位到唯一的连接，那么建立在TCP上的HTTP，服务器使用HTTP协议是不是通过这种方式建立的session？？？？？定位到唯一客户机 P132 2018年5月23日 08:35:16
##无连接运输：UDP
- UDP只是做了运输协议能够做的最少的工作。除了多路复用、多路分解功能及一些轻型的差错检测外，它几乎没有对IP增加别的东西，实际上，如果应用程序开发人员选择UDP而不是TCP，则应用程序几乎是直接和IP打交道。
- 使用UDP时，在发送报文之前，发送方和接受方的运输实体之间没有进行握手，因此UDP被称为无连接。
- DNS是基于UDP协议的应用层协议。当一台主机中的DNS应用程序想要进行一次查询时，它构造了一条DNS查询报文并将其交给UDP。无需执行任何与运行在目的端系统中的UDP实体之间的握手，主机端的UDP为此报文添加首部字段，然后将形成的报文段
交给网络层，网络层将此UDP报文段封装进一个IP数据报中，然后将其发送给一个名字服务器。
- UDP的优势：应用层更好的控制要发送的数据和发送时间；无需建立连接；无连接状态；分组首部开销小（TCP20个字节首部开销，UDP8个字节首部开销）；
- UDP：名字转换（DNS）、选路协议（RIP）、网络管理（SNMP）、因特网电话、流式多媒体、远程文件服务器；TCP：电子邮件（SMTP）、远程终端访问（Telent）、web(Http)、文件传输（FTP）2018年5月23日 12:37:14 P134
###UDP报文段结构
- UDP首部包含四个字段:源端口号、目的端口号、长度、检验和，每个字段包含2个字节，应用层数据占用了UDP报文段的数据字段。
- UDP检验和提供了差错检测功能。
###UDP检验和
- UDP检验和提供了差错检测功能，即检验和用于确定当UDP报文段从源到达目的时，其中的比特是否发生了变化。发送方的UDP对报文段中的所有16比特字的和进行反码运算，求和时遇到任何溢出都会被回卷。
##可靠数据传输的原理
###构造可靠数据传输协议
- 有限状态机（FSM）
- 肯定确认（ACK）、否定确认（NAK）、自动重传请求（ARQ）协议
- ARQ协议还需要另外三种协议来处理存在的比特差错：差错检测（一种使接收方能检测到何时出现比特差错的机制）、接受方反馈（0标识NAK，1表示ACK）、重传
- 停等协议
- 在数据分组中添加一个新字段，让发送方对其数据分组排序，将发送的数据分组的序号放在该字段。  2018年5月24日 08:16:42  P142
###流水线可靠数据传输协议
###回退N步
###选择重传

##面向连接的运输：TCP
###TCP连接
###TCP报文段结构
###往返时延的估计与超时
###可靠数据传输
###流量控制
###TCP连接管理

##拥塞控制原理
###拥塞原因与开销
###拥塞控制方法
###网络辅助的拥塞控制例子：ATMABR拥塞控制

##TCP拥塞控制